# Stage 1.1: Infrastructure Setup

**Phase 6: Production Deployment & App Store Launch**
**Document Version**: 1.0
**Last Updated**: September 26, 2025

## Objective
Establish complete deployment infrastructure for Lopan iOS production management app, building on the solid Phase 4 foundation.

## Prerequisites
- ‚úÖ Phase 1-4 completed (100% ready)
- ‚úÖ Clean iOS 26 build verified
- ‚úÖ Performance systems operational
- ‚úÖ GitHub repository with CI/CD pipeline

---

## üèóÔ∏è Tasks

### 1.1.1 CI/CD Directory Structure
**Duration**: 1 hour
**Priority**: Critical

#### Create `/ci/` directory structure
```bash
mkdir -p ci/{configs,scripts,templates}
```

#### Required Files:
- `ci/ExportOptions.plist` - App Store distribution config
- `ci/ExportOptions-TestFlight.plist` - Beta distribution config
- `ci/build-config.json` - Build configuration parameters
- `ci/version-bump.sh` - Automated version management

#### GitHub Actions Integration
- Validate existing `.github/workflows/ios-build-deploy.yml`
- Add missing CI secrets configuration
- Test build pipeline with new configs

**Success Criteria**:
- [ ] CI directory structure created
- [ ] Export options files configured
- [ ] GitHub Actions pipeline tested
- [ ] All builds complete without errors

---

### 1.1.2 Fastlane Deployment Setup
**Duration**: 2 hours
**Priority**: Critical

#### Installation & Initialization
```bash
# Install fastlane (if not present)
gem install fastlane

# Initialize in project root
cd /path/to/Lopan
fastlane init
```

#### Configuration Files:
1. **`fastlane/Fastfile`** - Main deployment lanes
2. **`fastlane/Appfile`** - App and team configuration
3. **`fastlane/Matchfile`** - Certificate management
4. **`fastlane/Deliverfile`** - App Store delivery options

#### Deployment Lanes:
- `fastlane beta` - TestFlight deployment
- `fastlane release` - App Store submission
- `fastlane screenshots` - Automated screenshot generation
- `fastlane certificates` - Certificate management

**Success Criteria**:
- [ ] Fastlane installed and configured
- [ ] All lanes execute without errors
- [ ] Certificate management operational
- [ ] TestFlight upload tested

---

### 1.1.3 Version Management System
**Duration**: 30 minutes
**Priority**: High

#### Current Configuration:
- `MARKETING_VERSION`: 1.0 ‚Üí 1.0.0
- `CURRENT_PROJECT_VERSION`: 1 ‚Üí 100 (build number)

#### Automated Versioning:
```bash
# Increment build number
fastlane increment_build_number

# Increment version (patch/minor/major)
fastlane increment_version_number bump_type:patch
```

#### Git Tagging Strategy:
- Release tags: `v1.0.0`
- Build tags: `v1.0.0-100`
- Beta tags: `v1.0.0-beta.1`

**Success Criteria**:
- [ ] Version numbers updated
- [ ] Automatic increment working
- [ ] Git tagging operational
- [ ] Build numbers unique

---

### 1.1.4 Certificate & Provisioning Management
**Duration**: 1.5 hours
**Priority**: Critical

#### Match Setup (Certificate Management)
```bash
# Initialize match
fastlane match init

# Generate/sync certificates
fastlane match appstore
fastlane match development
```

#### Required Certificates:
- **Development**: For local testing and debugging
- **Distribution**: For App Store and TestFlight
- **Push Notifications**: For production alerts
- **App Groups**: For shared data access

#### Provisioning Profiles:
- `com.lopanng.Lopan` - Main app profile
- `com.lopanng.Lopan.widget` - Widget extension (future)
- `com.lopanng.Lopan.watchapp` - Watch app (future)

**Success Criteria**:
- [ ] All certificates valid and synced
- [ ] Provisioning profiles active
- [ ] Code signing automatic
- [ ] Distribution build successful

---

## üîß Implementation Commands

### Quick Setup Script:
```bash
#!/bin/bash
echo "üöÄ Setting up Lopan deployment infrastructure..."

# Create CI directory
mkdir -p ci/{configs,scripts,templates}

# Install fastlane
gem install fastlane

# Initialize fastlane
fastlane init

# Setup match for certificates
fastlane match init

echo "‚úÖ Infrastructure setup complete!"
```

---

## ‚úÖ Validation Checklist

### Pre-Setup Validation:
- [ ] Phase 4 systems fully operational
- [ ] Clean build on iOS 26 verified
- [ ] All performance components integrated
- [ ] GitHub repository access confirmed

### Post-Setup Validation:
- [ ] CI directory structure created
- [ ] Fastlane lanes executable
- [ ] Certificates properly configured
- [ ] Version management working
- [ ] Build pipeline operational

### Integration Testing:
- [ ] TestFlight build completes
- [ ] Distribution signing works
- [ ] Screenshots generate properly
- [ ] Metadata validation passes

---

## üìä Performance Integration

### Phase 4 Component Validation:
Since we have completed Phase 4 with production-ready performance systems, ensure these are properly integrated:

- **LopanPerformanceProfiler**: Active in production builds
- **LopanMemoryManager**: Memory optimization enabled
- **LopanProductionMonitoring**: Analytics ready for deployment
- **Testing Infrastructure**: CI integration for automated validation

### Production Readiness Check:
```bash
# Verify Phase 4 components exist
ls -la Lopan/Services/LopanPerformance*
ls -la Lopan/Services/LopanMemory*
ls -la Lopan/Services/LopanProduction*
```

---

## üîÑ Next Steps

Upon completion of Infrastructure Setup:
1. **Proceed to Stage 1.2**: Asset Preparation
2. **Validate**: All systems operational
3. **Document**: Any configuration variations
4. **Test**: Complete deployment pipeline

---

**Dependencies**: Phase 1-4 completion
**Estimated Duration**: 5 hours
**Team Members**: iOS Developer, DevOps Engineer
**Risk Level**: Medium (certificate management complexity)